{"version":3,"file":"js/decidim_elections_admin_trustees_process-aedda585bc7cbcf65d49.js","mappings":"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","sources":["webpack://decidim-development-app/webpack/runtime/chunk loaded","webpack://decidim-development-app/./node_modules/@decidim/decidim-bulletin_board/src/client/message-identifier.js","webpack://decidim-development-app/./node_modules/@decidim/decidim-bulletin_board/src/client/message-parser.js","webpack://decidim-development-app/./node_modules/@decidim/decidim-bulletin_board/src/election/election.js","webpack://decidim-development-app/./node_modules/@decidim/decidim-bulletin_board/src/utils.js","webpack://decidim-development-app/../decidim-elections/app/packs/src/decidim/elections/admin/trustees_process.js","webpack://decidim-development-app/../decidim-elections/app/packs/src/decidim/elections/broken_promises_handler.js","webpack://decidim-development-app/./node_modules/node-jose/lib/index.js","webpack://decidim-development-app/webpack/bootstrap","webpack://decidim-development-app/webpack/runtime/compat get default export","webpack://decidim-development-app/webpack/runtime/define property getters","webpack://decidim-development-app/webpack/runtime/global","webpack://decidim-development-app/webpack/runtime/hasOwnProperty shorthand","webpack://decidim-development-app/webpack/runtime/node module decorator","webpack://decidim-development-app/webpack/runtime/jsonp chunk loading","webpack://decidim-development-app/webpack/startup"],"sourcesContent":["var deferred = [];\n__webpack_require__.O = function(result, chunkIds, fn, priority) {\n\tif(chunkIds) {\n\t\tpriority = priority || 0;\n\t\tfor(var i = deferred.length; i > 0 && deferred[i - 1][2] > priority; i--) deferred[i] = deferred[i - 1];\n\t\tdeferred[i] = [chunkIds, fn, priority];\n\t\treturn;\n\t}\n\tvar notFulfilled = Infinity;\n\tfor (var i = 0; i < deferred.length; i++) {\n\t\tvar chunkIds = deferred[i][0];\n\t\tvar fn = deferred[i][1];\n\t\tvar priority = deferred[i][2];\n\t\tvar fulfilled = true;\n\t\tfor (var j = 0; j < chunkIds.length; j++) {\n\t\t\tif ((priority & 1 === 0 || notFulfilled >= priority) && Object.keys(__webpack_require__.O).every(function(key) { return __webpack_require__.O[key](chunkIds[j]); })) {\n\t\t\t\tchunkIds.splice(j--, 1);\n\t\t\t} else {\n\t\t\t\tfulfilled = false;\n\t\t\t\tif(priority < notFulfilled) notFulfilled = priority;\n\t\t\t}\n\t\t}\n\t\tif(fulfilled) {\n\t\t\tdeferred.splice(i--, 1)\n\t\t\tvar r = fn();\n\t\t\tif (r !== undefined) result = r;\n\t\t}\n\t}\n\treturn result;\n};","export const AUTHORITY_TYPE = \"a\";\nexport const BULLETIN_BOARD_TYPE = \"b\";\nexport const VOTER_TYPE = \"v\";\nexport const TRUSTEE_TYPE = \"t\";\nexport const VALID_TYPES = [\n  AUTHORITY_TYPE,\n  BULLETIN_BOARD_TYPE,\n  VOTER_TYPE,\n  TRUSTEE_TYPE,\n];\n\n/**\n * This is a class that handles message id strings.\n */\nexport class MessageIdentifier {\n  /**\n   * Parses a message id string into a JS object.\n   *\n   * @param {String} messageId - A string with a message id.\n   * @returns {Object} - An object with the message id values.\n   */\n  static parse(messageId) {\n    const [elements, author] = messageId.split(\"+\");\n    const [authority, electionId, type, subtype] = elements.split(\".\", 4);\n    const [authorType, authorId] = author.split(\".\", 2);\n    const dotSubtype = subtype ? `.${subtype}` : \"\";\n\n    if (!VALID_TYPES.includes(authorType)) {\n      throw new Error(\"Invalid message identifier format\");\n    }\n\n    return {\n      electionId: `${authority}.${electionId}`,\n      type,\n      subtype,\n      typeSubtype: `${type}${dotSubtype}`,\n      author: {\n        type: authorType,\n        id: authorId,\n      },\n    };\n  }\n\n  static format(electionId, typeSubtype, authorType, authorId) {\n    return `${electionId}.${typeSubtype}+${authorType}.${authorId}`;\n  }\n}\n","import { JWS, JWK } from \"node-jose\";\nimport {\n  MessageIdentifier,\n  AUTHORITY_TYPE,\n  BULLETIN_BOARD_TYPE,\n  TRUSTEE_TYPE,\n} from \"./message-identifier\";\nimport { samePublicKeys } from \"../utils\";\n\n/**\n * Verify and parses JWT tokens.\n */\nexport class MessageParser {\n  /**\n   * Initializes the class with the given params.\n   *\n   * @constructor\n   * @param {Object} params - An object that contains the initialization params.\n   * - {String} authorityPublicKeyJSON - The public key of the authority\n   */\n  constructor({ authorityPublicKeyJSON }) {\n    this.authorityPublicKeyJSON = authorityPublicKeyJSON;\n    this.authorityPublicKey = JWK.asKey(authorityPublicKeyJSON, \"json\");\n    this.keys = null;\n  }\n\n  /**\n   * Parses the given token only if it can be verified.\n   *\n   * @param {String} token - A JWT token.\n   * @returns {Promise<Object>} - The payload included in the token.\n   * @throws An error is thrown if the payload is not a valid JSON or the token\n   *         cannot be verified.\n   */\n  async parse({ messageId, signedData }) {\n    const messageIdentifier = MessageIdentifier.parse(messageId);\n    const senderKey = await (this.keys\n      ? this.keys[messageIdentifier.author.type][messageIdentifier.author.id]\n      : this.authorityPublicKey);\n\n    if (!signedData) {\n      return { messageIdentifier, decodedData: null };\n    }\n\n    const result = await JWS.createVerify(senderKey).verify(signedData, {\n      algorithms: [\"RS256\"],\n    });\n\n    const decodedData = JSON.parse(\n      new TextDecoder(\"utf-8\").decode(result.payload)\n    );\n\n    if (!this.keys) {\n      this.keys = await this.parseCreateElection(decodedData);\n    }\n\n    return { messageIdentifier, decodedData };\n  }\n\n  /* eslint-disable camelcase */\n  async parseCreateElection({ authority, bulletin_board, trustees }) {\n    if (!samePublicKeys(authority.public_key, this.authorityPublicKeyJSON)) {\n      throw new Error(\n        \"The authority public key doesn't match the election's authority public key.\"\n      );\n    }\n\n    const result = {\n      [AUTHORITY_TYPE]: { [authority.slug]: this.authorityPublicKey },\n      [BULLETIN_BOARD_TYPE]: {},\n      [TRUSTEE_TYPE]: {},\n    };\n\n    const promises = [];\n    promises.push(\n      this.loadKey(bulletin_board).then((key) => {\n        result[BULLETIN_BOARD_TYPE][bulletin_board.slug] = key;\n      })\n    );\n    for (const trustee of trustees) {\n      promises.push(\n        this.loadKey(trustee).then((key) => {\n          result[TRUSTEE_TYPE][trustee.slug] = key;\n        })\n      );\n    }\n\n    await Promise.all(promises);\n\n    return result;\n  }\n  /* eslint-enable camelcase */\n\n  loadKey(client) {\n    return JWK.asKey(client.public_key, \"json\");\n  }\n}\n","import { MessageIdentifier, TRUSTEE_TYPE } from \"../client/message-identifier\";\n\nexport const WAIT_TIME_MS = 2_000; // 2s\n\n/**\n * Handles the election state and includes some methods to interact with the election log.\n */\nexport class Election {\n  /**\n   * Initializes the class with the given params.\n   *\n   * @constructor\n   * @param {Object} params - An object that contains the initialization params.\n   *  - {String} uniqueId - The unique identifier of an election.\n   *  - {Client} bulletinBoardClient - An instance of the Bulletin Board Client\n   *  - {Array<String>} typesFilter - The list of type of messages to retrieve.\n   *  - {Object?} options - An optional object with some extra options.\n   */\n  constructor({ uniqueId, bulletinBoardClient, typesFilter, options }) {\n    this.uniqueId = uniqueId;\n    this.bulletinBoardClient = bulletinBoardClient;\n    this.logEntries = [];\n    this.typesFilter = typesFilter;\n    this.subscriptionId = null;\n    this.options = options || { waitUntilNextCheck: WAIT_TIME_MS };\n  }\n\n  /**\n   * Store the election log entries and periodically check if there are new entries.\n   *\n   * @returns {Promise<undefined>}\n   */\n  async subscribeToLogEntriesChanges() {\n    this.unsubscribeToLogEntriesChanges();\n\n    // Ensure that we get the current log entries before starting the subscription.\n    await this.getLogEntries();\n\n    this.subscriptionId = setInterval(() => {\n      this.getLogEntries();\n    }, this.options.waitUntilNextCheck);\n  }\n\n  /**\n   * Clear the periodically checks of new log entries.\n   *\n   * @returns {undefined}\n   */\n  unsubscribeToLogEntriesChanges() {\n    if (this.subscriptionId !== null) {\n      clearInterval(this.subscriptionId);\n      this.subscriptionId = null;\n    }\n  }\n\n  /**\n   * Return the last message stored in the log sent by the given trustee.\n   *\n   * @param {String} trusteeId - The unique identifier of a trustee.\n   * @returns {Object|null}\n   */\n  getLastMessageFromTrustee(trusteeId) {\n    for (let i = this.logEntries.length - 1; i >= 0; i--) {\n      const logEntry = this.logEntries[i];\n      const messageIdentifier = MessageIdentifier.parse(logEntry.messageId);\n      if (\n        messageIdentifier.author.type === TRUSTEE_TYPE &&\n        messageIdentifier.author.id === trusteeId\n      ) {\n        return logEntry;\n      }\n    }\n\n    return null;\n  }\n\n  /**\n   * Uses the bulletin board client to get all the election log entries after the\n   * last log entry stored in the election's state.\n   *\n   * @private\n   * @returns {Promise<nothing>}\n   */\n  getLogEntries() {\n    const lastLogEntry = this.logEntries[this.logEntries.length - 1];\n    const after = (lastLogEntry && lastLogEntry.id) || null;\n\n    return new Promise((resolve) => {\n      this.bulletinBoardClient\n        .getElectionLogEntries({\n          electionUniqueId: this.uniqueId,\n          after,\n          types: this.typesFilter,\n        })\n        .then((logEntries) => {\n          if (logEntries.length) {\n            this.logEntries = [...this.logEntries, ...logEntries];\n          }\n          resolve();\n        });\n    });\n  }\n}\n","export function samePublicKeys(key1, key2) {\n  const jwk1 = typeof key1 === \"string\" ? JSON.parse(key1) : key1;\n  const jwk2 = typeof key2 === \"string\" ? JSON.parse(key2) : key2;\n\n  if (jwk1 && jwk2) {\n    const { n: n1, e: e1, kty: kty1 } = jwk1;\n    const { n: n2, e: e2, kty: kty2 } = jwk2;\n\n    return n1 === n2 && e1 === e2 && kty1 === kty2;\n  }\n  return false;\n}\n","// show a message to the user if comunication is lost\nimport \"src/decidim/elections/broken_promises_handler\";\nimport {\n  Client,\n  Election,\n  MessageParser\n} from \"@decidim/decidim-bulletin_board\";\n\nconst WAIT_TIME_MS = 10 * 1_000;\n\n$(async () => {\n  const $trusteesProcess = $(\"#trustees_process\");\n  const $checkingTrustees = $trusteesProcess.find(\".trustee\");\n  const electionUniqueId = $trusteesProcess.data(\"electionUniqueId\");\n  const processType = $trusteesProcess.data(\"processType\");\n  const bulletinBoardClient = new Client({\n    apiEndpointUrl: $trusteesProcess.data(\"apiEndpointUrl\")\n  });\n  const election = new Election({\n    uniqueId: electionUniqueId,\n    bulletinBoardClient,\n    typesFilter: [\"create_election\", processType]\n  });\n\n  const authorityPublicKeyJSON = JSON.stringify(\n    $trusteesProcess.data(\"authorityPublicKey\")\n  );\n  const parser = new MessageParser({ authorityPublicKeyJSON });\n  const trusteesStatuses = {};\n  let lastMessageIndex = 0;\n\n  const missingTrusteesAllowed = $trusteesProcess.data(\"missingTrusteesAllowed\") || 0;\n  const checkPendingActionPath = $trusteesProcess.data(\"checkPendingActionPath\");\n\n  // Fix buttons formaction, that is not working properly\n  const $form = $(\"form.step\");\n  $form.find(\"button\").on(\"click\", (event) => {\n    $form.attr(\"action\", $(event.currentTarget).attr(\"formaction\"));\n    $form.trigger(\"submit\");\n  });\n\n  const updateTrusteesStatuses = async () => {\n    await election.getLogEntries();\n\n    for (\n      ;\n      lastMessageIndex < election.logEntries.length;\n      lastMessageIndex += 1\n    ) {\n      const { messageIdentifier, decodedData } = await parser.parse(\n        election.logEntries[lastMessageIndex]\n      );\n\n      if (messageIdentifier.author.type === \"t\") {\n        trusteesStatuses[messageIdentifier.author.id] = true;\n      } else if (\n        messageIdentifier.type === \"tally\" &&\n        messageIdentifier.subtype === \"missing_trustee\" &&\n        !(decodedData.trustee_id in trusteesStatuses)\n      ) {\n        trusteesStatuses[decodedData.trustee_id] = false;\n      }\n    }\n  }\n\n  const checkPendingAction = async () => {\n    if (!checkPendingActionPath) {\n      return false\n    }\n\n    try {\n      const response = await $.ajax({\n        url: checkPendingActionPath,\n        method: \"PATCH\",\n        contentType: \"application/json\",\n        headers: {\n          \"X-CSRF-Token\": $(\"meta[name=csrf-token]\").attr(\"content\")\n        }\n      })\n\n      return response && response.status === \"pending\";\n    } catch (err) {\n      return true;\n    }\n  }\n\n  const checkTrusteesActivity = async () => {\n    await updateTrusteesStatuses();\n    const pendingAction = await checkPendingAction();\n    const missingTrustees = Object.values(trusteesStatuses).filter(\n      (present) => !present\n    ).length;\n    const allowReportMissing = missingTrustees < missingTrusteesAllowed;\n\n    $checkingTrustees.each((_index, trustee) => {\n      const $trustee = $(trustee);\n      const trusteeSlug = $trustee.data(\"trusteeSlug\");\n\n      if (trusteeSlug in trusteesStatuses) {\n        if (missingTrusteesAllowed > 0) {\n          $trustee.find(\".js-report-missing-trustee\").addClass(\"hide\");\n        }\n        $trustee.removeClass(\"loading\");\n        $trustee.find(\".loading\").hide();\n        if (trusteesStatuses[trusteeSlug]) {\n          $trustee.find(\".active\").removeClass(\"hide\");\n          $trustee.find(\".missing\").addClass(\"hide\");\n        } else {\n          $trustee.find(\".missing\").removeClass(\"hide\");\n        }\n      } else if (allowReportMissing && !pendingAction) {\n        $trustee.find(\".js-report-missing-trustee\").removeClass(\"hide\");\n      }\n    });\n\n    if (\n      Object.keys(trusteesStatuses).length === $checkingTrustees.length &&\n      missingTrustees <= missingTrusteesAllowed && !pendingAction\n    ) {\n      $(\".js-continue-link\").removeClass(\"disabled\");\n    } else {\n      setTimeout(checkTrusteesActivity, WAIT_TIME_MS);\n    }\n  };\n\n  await checkTrusteesActivity();\n});\n","/* Fallback for non-handled failed promises */\nwindow.addEventListener(\"unhandledrejection\", (event) => {\n  console.log(\"broken\", event)\n  $(\"#server-failure .tech-info\").html(event.reason);\n  if (event.reason.toString().indexOf(\"fetch\") === -1) {\n    $(\"#server-failure .communication_error\").addClass(\"hide\");\n    $(\"#server-failure .generic_error\").removeClass(\"hide\");\n  }\n  $(\"#server-failure\").foundation(\"open\");\n});\n\n","/*!\n * index.js - Main Entry Point\n *\n * Copyright (c) 2015 Cisco Systems, Inc. See LICENSE file.\n */\n\"use strict\";\n\nif (typeof Promise === \"undefined\") {\n  require(\"es6-promise\").polyfill();\n}\n\nif (typeof Buffer === \"undefined\") {\n  (global || window).Buffer = require(\"buffer\").Buffer;\n}\n\nif (typeof process === \"undefined\") {\n  (global || window).process = require(\"process\");\n}\n\nif (!process.version) {\n  process.version = \"\";\n}\n\nvar JWS = require(\"./jws\");\n\nmodule.exports = {\n  JWA: require(\"./algorithms\"),\n  JWE: require(\"./jwe\"),\n  JWK: require(\"./jwk\"),\n  JWS: JWS,\n  util: require(\"./util\"),\n  parse: require(\"./parse\"),\n  canYouSee: JWS.createVerify\n};\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\tid: moduleId,\n\t\tloaded: false,\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n\t// Flag the module as loaded\n\tmodule.loaded = true;\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n// expose the modules object (__webpack_modules__)\n__webpack_require__.m = __webpack_modules__;\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = function(module) {\n\tvar getter = module && module.__esModule ?\n\t\tfunction() { return module['default']; } :\n\t\tfunction() { return module; };\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = function(exports, definition) {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.g = (function() {\n\tif (typeof globalThis === 'object') return globalThis;\n\ttry {\n\t\treturn this || new Function('return this')();\n\t} catch (e) {\n\t\tif (typeof window === 'object') return window;\n\t}\n})();","__webpack_require__.o = function(obj, prop) { return Object.prototype.hasOwnProperty.call(obj, prop); }","__webpack_require__.nmd = function(module) {\n\tmodule.paths = [];\n\tif (!module.children) module.children = [];\n\treturn module;\n};","// no baseURI\n\n// object to store loaded and loading chunks\n// undefined = chunk not loaded, null = chunk preloaded/prefetched\n// [resolve, reject, Promise] = chunk loading, 0 = chunk loaded\nvar installedChunks = {\n\t2748: 0\n};\n\n// no chunk on demand loading\n\n// no prefetching\n\n// no preloaded\n\n// no HMR\n\n// no HMR manifest\n\n__webpack_require__.O.j = function(chunkId) { return installedChunks[chunkId] === 0; };\n\n// install a JSONP callback for chunk loading\nvar webpackJsonpCallback = function(parentChunkLoadingFunction, data) {\n\tvar chunkIds = data[0];\n\tvar moreModules = data[1];\n\tvar runtime = data[2];\n\t// add \"moreModules\" to the modules object,\n\t// then flag all \"chunkIds\" as loaded and fire callback\n\tvar moduleId, chunkId, i = 0;\n\tif(chunkIds.some(function(id) { return installedChunks[id] !== 0; })) {\n\t\tfor(moduleId in moreModules) {\n\t\t\tif(__webpack_require__.o(moreModules, moduleId)) {\n\t\t\t\t__webpack_require__.m[moduleId] = moreModules[moduleId];\n\t\t\t}\n\t\t}\n\t\tif(runtime) var result = runtime(__webpack_require__);\n\t}\n\tif(parentChunkLoadingFunction) parentChunkLoadingFunction(data);\n\tfor(;i < chunkIds.length; i++) {\n\t\tchunkId = chunkIds[i];\n\t\tif(__webpack_require__.o(installedChunks, chunkId) && installedChunks[chunkId]) {\n\t\t\tinstalledChunks[chunkId][0]();\n\t\t}\n\t\tinstalledChunks[chunkId] = 0;\n\t}\n\treturn __webpack_require__.O(result);\n}\n\nvar chunkLoadingGlobal = self[\"webpackChunkdecidim_development_app\"] = self[\"webpackChunkdecidim_development_app\"] || [];\nchunkLoadingGlobal.forEach(webpackJsonpCallback.bind(null, 0));\nchunkLoadingGlobal.push = webpackJsonpCallback.bind(null, chunkLoadingGlobal.push.bind(chunkLoadingGlobal));","// startup\n// Load entry module and return exports\n// This entry module depends on other loaded chunks and execution need to be delayed\nvar __webpack_exports__ = __webpack_require__.O(undefined, [9098,8276,3229], function() { return __webpack_require__(27068); })\n__webpack_exports__ = __webpack_require__.O(__webpack_exports__);\n"],"names":["deferred","AUTHORITY_TYPE","BULLETIN_BOARD_TYPE","TRUSTEE_TYPE","VALID_TYPES","MessageIdentifier","static","messageId","elements","author","split","authority","electionId","type","subtype","authorType","authorId","dotSubtype","includes","Error","typeSubtype","id","MessageParser","constructor","authorityPublicKeyJSON","this","authorityPublicKey","JWK","keys","async","signedData","messageIdentifier","senderKey","decodedData","result","JWS","verify","algorithms","JSON","parse","TextDecoder","decode","payload","parseCreateElection","bulletin_board","trustees","public_key","slug","promises","push","loadKey","then","key","trustee","Promise","all","client","Election","uniqueId","bulletinBoardClient","typesFilter","options","logEntries","subscriptionId","waitUntilNextCheck","unsubscribeToLogEntriesChanges","getLogEntries","setInterval","clearInterval","getLastMessageFromTrustee","trusteeId","i","length","logEntry","lastLogEntry","after","resolve","getElectionLogEntries","electionUniqueId","types","samePublicKeys","key1","key2","jwk1","jwk2","n","n1","e","e1","kty","kty1","n2","e2","kty2","$","$trusteesProcess","$checkingTrustees","find","data","processType","Client","apiEndpointUrl","election","stringify","parser","trusteesStatuses","lastMessageIndex","missingTrusteesAllowed","checkPendingActionPath","$form","on","event","attr","currentTarget","trigger","updateTrusteesStatuses","trustee_id","checkPendingAction","ajax","url","method","contentType","headers","response","status","checkTrusteesActivity","pendingAction","missingTrustees","Object","values","filter","present","allowReportMissing","each","_index","$trustee","trusteeSlug","addClass","removeClass","hide","setTimeout","window","addEventListener","console","log","html","reason","toString","indexOf","foundation","Buffer","g","process","version","module","exports","JWA","JWE","util","canYouSee","createVerify","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","undefined","loaded","__webpack_modules__","call","m","O","chunkIds","fn","priority","notFulfilled","Infinity","fulfilled","j","every","splice","r","getter","__esModule","d","a","definition","o","defineProperty","enumerable","get","globalThis","Function","obj","prop","prototype","hasOwnProperty","nmd","paths","children","installedChunks","chunkId","webpackJsonpCallback","parentChunkLoadingFunction","moreModules","runtime","some","chunkLoadingGlobal","self","forEach","bind","__webpack_exports__"],"sourceRoot":""}