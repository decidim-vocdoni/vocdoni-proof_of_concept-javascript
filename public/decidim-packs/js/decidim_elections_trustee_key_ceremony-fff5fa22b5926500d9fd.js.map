{"version":3,"file":"js/decidim_elections_trustee_key_ceremony-fff5fa22b5926500d9fd.js","mappings":"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","sources":["webpack://decidim-development-app/webpack/runtime/chunk loaded","webpack://decidim-development-app/./node_modules/@decidim/decidim-bulletin_board/src/key-ceremony/key-ceremony.component.js","webpack://decidim-development-app/../decidim-elections/app/packs/src/decidim/elections/trustee/key_ceremony.js","webpack://decidim-development-app/../decidim-elections/app/packs/src/decidim/elections/broken_promises_handler.js","webpack://decidim-development-app/webpack/bootstrap","webpack://decidim-development-app/webpack/runtime/compat get default export","webpack://decidim-development-app/webpack/runtime/define property getters","webpack://decidim-development-app/webpack/runtime/global","webpack://decidim-development-app/webpack/runtime/hasOwnProperty shorthand","webpack://decidim-development-app/webpack/runtime/node module decorator","webpack://decidim-development-app/webpack/runtime/jsonp chunk loading","webpack://decidim-development-app/webpack/startup"],"sourcesContent":["var deferred = [];\n__webpack_require__.O = function(result, chunkIds, fn, priority) {\n\tif(chunkIds) {\n\t\tpriority = priority || 0;\n\t\tfor(var i = deferred.length; i > 0 && deferred[i - 1][2] > priority; i--) deferred[i] = deferred[i - 1];\n\t\tdeferred[i] = [chunkIds, fn, priority];\n\t\treturn;\n\t}\n\tvar notFulfilled = Infinity;\n\tfor (var i = 0; i < deferred.length; i++) {\n\t\tvar chunkIds = deferred[i][0];\n\t\tvar fn = deferred[i][1];\n\t\tvar priority = deferred[i][2];\n\t\tvar fulfilled = true;\n\t\tfor (var j = 0; j < chunkIds.length; j++) {\n\t\t\tif ((priority & 1 === 0 || notFulfilled >= priority) && Object.keys(__webpack_require__.O).every(function(key) { return __webpack_require__.O[key](chunkIds[j]); })) {\n\t\t\t\tchunkIds.splice(j--, 1);\n\t\t\t} else {\n\t\t\t\tfulfilled = false;\n\t\t\t\tif(priority < notFulfilled) notFulfilled = priority;\n\t\t\t}\n\t\t}\n\t\tif(fulfilled) {\n\t\t\tdeferred.splice(i--, 1)\n\t\t\tvar r = fn();\n\t\t\tif (r !== undefined) result = r;\n\t\t}\n\t}\n\treturn result;\n};","// Components\nimport { TrusteeComponent } from \"../trustee/trustee.component\";\n\n/**\n * This class is used to bind any UI elements to a key ceremony process.\n */\nexport class KeyCeremonyComponent extends TrusteeComponent {\n  /**\n   * Setup the election for the trustee.\n   *\n   * @param {Object} params - An object that contains the initialization params.\n   *  - {Object} bulletinBoardClientParams - An object to configure the bulletin board client.\n   *  - {String} electionUniqueId - The unique identifier of an election.\n   *  - {Number} authorizationExpirationTimestamp - The timestamp until the authorization header is no longer valid.\n   *\n   * @returns {Promise<undefined>}\n   */\n  setupElection({\n    bulletinBoardClientParams,\n    electionUniqueId,\n    authorizationExpirationTimestamp,\n  }) {\n    return this.setupElectionWithTypesFilter({\n      electionUniqueId,\n      bulletinBoardClientParams,\n      authorizationExpirationTimestamp,\n      typesFilter: [\n        \"create_election\",\n        \"start_key_ceremony\",\n        \"key_ceremony\",\n        \"end_key_ceremony\",\n      ],\n    });\n  }\n\n  /**\n   * Bind UI events to the key ceremony process.\n   *\n   * @method bindEvents\n   * @param {Object} eventCallbacks - An object that contains event callback functions.\n   * - {Function} onEvent - a function that is called when an event is emitted from the trustee.\n   * - {Function} onBindRestoreButton - a function that receives a callback function that will be called when\n   *                                    the restore process must be started.\n   * - {Function} onBindStartButton - a function that receives a callback function that will be called when\n   *                                  the key ceremony must be started.\n   * - {Function} onRestore - a function that is called when the trustee is restored.\n   * - {Function} onComplete - a function that is called when the key ceremony is done.\n   * - {Function} onStart - a function that is called when the key ceremony has started.\n   * - {Function} onTrusteeNeedsToBeRestored - a function that is called when the trustee must be restored.\n   * - {Function} onBackupNeeded - a function that is called when the trustee backup is required.\n   * - {Function} onBindBackupButton - a function that receives a callback function that will be called when\n   *                                   the trustee backup must be started.\n   * - {Function} onBackupStarted - a function that is called when the backup has started.\n   *\n   * @returns {Promise<undefined>}\n   */\n  async bindEvents({\n    onEvent,\n    onBindRestoreButton,\n    onBindStartButton,\n    onRestore,\n    onComplete,\n    onStart,\n    onTrusteeNeedsToBeRestored,\n    onBackupNeeded,\n    onBindBackupButton,\n    onBackupStarted,\n  }) {\n    const onSetupDone = this.trustee.setup();\n\n    this.trustee.events.subscribe(onEvent);\n\n    onBindStartButton(async (event) => {\n      onStart();\n      event.preventDefault();\n\n      await onSetupDone;\n\n      if (await this.trustee.needsToBeRestored()) {\n        onTrusteeNeedsToBeRestored();\n      } else {\n        const keyCeremonySetup = this.trustee.setupKeyCeremony();\n        const { value: backupData } = await keyCeremonySetup.next();\n\n        onBackupNeeded();\n        onBindBackupButton(\n          backupData,\n          `${this.trustee.uniqueId}-election-${this.trustee.election.uniqueId}.bak`,\n          async () => {\n            onBackupStarted();\n            await keyCeremonySetup.next();\n            await this.trustee.runKeyCeremony();\n            onComplete();\n          }\n        );\n      }\n    });\n\n    onBindRestoreButton(async (event) => {\n      await onSetupDone;\n      const file = event.target.files[0];\n      const reader = new FileReader();\n      reader.onload = async ({ target }) => {\n        const content = target.result;\n        if (await this.trustee.restore(content)) {\n          onRestore();\n          await this.trustee.runKeyCeremony();\n          onComplete();\n        }\n      };\n      reader.readAsText(file);\n    });\n  }\n}\n","// show a message to the user if comunication is lost\nimport \"src/decidim/elections/broken_promises_handler\";\n\nimport {\n  KeyCeremonyComponent,\n  MessageIdentifier,\n  IdentificationKeys,\n  MESSAGE_RECEIVED\n} from \"@decidim/decidim-bulletin_board\";\n\nimport { TrusteeWrapperAdapter as DummyTrusteeWrapperAdapter } from \"@decidim/voting_schemes-dummy\";\nimport { TrusteeWrapperAdapter as ElectionGuardTrusteeWrapperAdapter } from \"@decidim/voting_schemes-electionguard\";\n\n/**\n * This file is responsible to generate election keys,\n * create a backup of keys for the trustee and\n * update the election bulletin board status\n */\n$(() => {\n  // UI Elements\n  const $keyCeremony = $(\".trustee-step\");\n  const $startButton = $keyCeremony.find(\".start\");\n  const $backupModal = $(\"#show-backup-modal\");\n  const $backupButton = $backupModal.find(\".download-election-keys\");\n  const $backButton = $keyCeremony.find(\".back\");\n  const $restoreModal = $(\"#show-restore-modal\");\n  const $restoreButton = $restoreModal.find(\".upload-election-keys\");\n  const getStepRow = (step) => {\n    return $(`#${step.replace(\".\", \"-\")}`);\n  };\n  const TRUSTEE_AUTHORIZATION_EXPIRATION_TIME_IN_HOURS = 2;\n\n  // Data\n  const bulletinBoardClientParams = {\n    apiEndpointUrl: $keyCeremony.data(\"apiEndpointUrl\")\n  };\n  const electionUniqueId = `${$keyCeremony.data(\n    \"authoritySlug\"\n  )}.${$keyCeremony.data(\"electionId\")}`;\n  const authorityPublicKeyJSON = JSON.stringify(\n    $keyCeremony.data(\"authorityPublicKey\")\n  );\n  const schemeName = $keyCeremony.data(\"schemeName\");\n\n  const trusteeContext = {\n    uniqueId: $keyCeremony.data(\"trusteeSlug\"),\n    publicKeyJSON: JSON.stringify($keyCeremony.data(\"trusteePublicKey\"))\n  };\n\n  let currentStep = null;\n  const trusteeIdentificationKeys = new IdentificationKeys(\n    trusteeContext.uniqueId,\n    trusteeContext.publicKeyJSON\n  );\n\n  // Use the correct trustee wrapper adapter\n  let trusteeWrapperAdapter = null;\n\n  if (schemeName === \"dummy\") {\n    trusteeWrapperAdapter = new DummyTrusteeWrapperAdapter({\n      trusteeId: trusteeContext.uniqueId\n    });\n  } else if (schemeName === \"electionguard\") {\n    trusteeWrapperAdapter = new ElectionGuardTrusteeWrapperAdapter({\n      trusteeId: trusteeContext.uniqueId,\n      workerUrl: \"/assets/electionguard/webworker.js\"\n    });\n  } else {\n    throw new Error(`Voting scheme ${schemeName} not supported.`);\n  }\n\n  // Use the key ceremony component and bind all UI events\n  const component = new KeyCeremonyComponent({\n    authorityPublicKeyJSON,\n    trusteeUniqueId: trusteeContext.uniqueId,\n    trusteeIdentificationKeys,\n    trusteeWrapperAdapter\n  });\n\n  trusteeIdentificationKeys.present(async (exists) => {\n    if (exists) {\n      await component.setupElection({\n        bulletinBoardClientParams,\n        electionUniqueId,\n        authorizationExpirationTimestamp:\n          Math.ceil(Number(new Date()) / 1000) +\n          TRUSTEE_AUTHORIZATION_EXPIRATION_TIME_IN_HOURS * 3600\n      });\n\n      await component.bindEvents({\n        onBindRestoreButton(onEventTriggered) {\n          $restoreButton.on(\n            \"change\",\n            \".restore-button-input\",\n            onEventTriggered\n          );\n        },\n        onBindStartButton(onEventTriggered) {\n          $startButton.on(\"click\", onEventTriggered);\n        },\n        onBindBackupButton(backupData, backupFilename, onEventTriggered) {\n          $backupButton.attr(\n            \"href\",\n            `data:text/plain;charset=utf-8,${backupData}`\n          );\n          $backupButton.attr(\"download\", backupFilename);\n          $backupButton.on(\"click\", onEventTriggered);\n        },\n        onEvent(event) {\n          let messageIdentifier = MessageIdentifier.parse(\n            event.message.messageId\n          );\n\n          if (event.type === MESSAGE_RECEIVED) {\n            if (currentStep && currentStep !== messageIdentifier.typeSubtype) {\n              const $previousStep = getStepRow(currentStep);\n              $previousStep.attr(\"data-step-status\", \"completed\");\n            }\n            currentStep = messageIdentifier.typeSubtype;\n\n            const $currentStep = getStepRow(currentStep);\n            if ($currentStep.data(\"step-status\") !== \"completed\") {\n              $currentStep.attr(\"data-step-status\", \"processing\");\n            }\n          }\n        },\n        onRestore() {\n          $restoreModal.foundation(\"close\");\n        },\n        onComplete() {\n          const $allSteps = $(\".step_status\");\n          $allSteps.attr(\"data-step-status\", \"completed\");\n\n          $startButton.addClass(\"hide\");\n          $backButton.removeClass(\"hide\");\n\n          $.ajax({\n            method: \"PATCH\",\n            url: $keyCeremony.data(\"updateElectionStatusUrl\"),\n            contentType: \"application/json\",\n            data: JSON.stringify({\n              status: \"key_ceremony\"\n            }),\n            headers: {\n              \"X-CSRF-Token\": $(\"meta[name=csrf-token]\").attr(\"content\")\n            }\n          });\n        },\n        onStart() {\n          $startButton.prop(\"disabled\", true);\n        },\n        onTrusteeNeedsToBeRestored() {\n          $restoreModal.foundation(\"open\");\n        },\n        onBackupNeeded() {\n          $backupModal.foundation(\"open\");\n        },\n        onBackupStarted() {\n          $backupModal.foundation(\"close\");\n        }\n      });\n\n      $startButton.prop(\"disabled\", false);\n    }\n  });\n});\n","/* Fallback for non-handled failed promises */\nwindow.addEventListener(\"unhandledrejection\", (event) => {\n  console.log(\"broken\", event)\n  $(\"#server-failure .tech-info\").html(event.reason);\n  if (event.reason.toString().indexOf(\"fetch\") === -1) {\n    $(\"#server-failure .communication_error\").addClass(\"hide\");\n    $(\"#server-failure .generic_error\").removeClass(\"hide\");\n  }\n  $(\"#server-failure\").foundation(\"open\");\n});\n\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\tid: moduleId,\n\t\tloaded: false,\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n\t// Flag the module as loaded\n\tmodule.loaded = true;\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n// expose the modules object (__webpack_modules__)\n__webpack_require__.m = __webpack_modules__;\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = function(module) {\n\tvar getter = module && module.__esModule ?\n\t\tfunction() { return module['default']; } :\n\t\tfunction() { return module; };\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = function(exports, definition) {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.g = (function() {\n\tif (typeof globalThis === 'object') return globalThis;\n\ttry {\n\t\treturn this || new Function('return this')();\n\t} catch (e) {\n\t\tif (typeof window === 'object') return window;\n\t}\n})();","__webpack_require__.o = function(obj, prop) { return Object.prototype.hasOwnProperty.call(obj, prop); }","__webpack_require__.nmd = function(module) {\n\tmodule.paths = [];\n\tif (!module.children) module.children = [];\n\treturn module;\n};","// no baseURI\n\n// object to store loaded and loading chunks\n// undefined = chunk not loaded, null = chunk preloaded/prefetched\n// [resolve, reject, Promise] = chunk loading, 0 = chunk loaded\nvar installedChunks = {\n\t2038: 0\n};\n\n// no chunk on demand loading\n\n// no prefetching\n\n// no preloaded\n\n// no HMR\n\n// no HMR manifest\n\n__webpack_require__.O.j = function(chunkId) { return installedChunks[chunkId] === 0; };\n\n// install a JSONP callback for chunk loading\nvar webpackJsonpCallback = function(parentChunkLoadingFunction, data) {\n\tvar chunkIds = data[0];\n\tvar moreModules = data[1];\n\tvar runtime = data[2];\n\t// add \"moreModules\" to the modules object,\n\t// then flag all \"chunkIds\" as loaded and fire callback\n\tvar moduleId, chunkId, i = 0;\n\tif(chunkIds.some(function(id) { return installedChunks[id] !== 0; })) {\n\t\tfor(moduleId in moreModules) {\n\t\t\tif(__webpack_require__.o(moreModules, moduleId)) {\n\t\t\t\t__webpack_require__.m[moduleId] = moreModules[moduleId];\n\t\t\t}\n\t\t}\n\t\tif(runtime) var result = runtime(__webpack_require__);\n\t}\n\tif(parentChunkLoadingFunction) parentChunkLoadingFunction(data);\n\tfor(;i < chunkIds.length; i++) {\n\t\tchunkId = chunkIds[i];\n\t\tif(__webpack_require__.o(installedChunks, chunkId) && installedChunks[chunkId]) {\n\t\t\tinstalledChunks[chunkId][0]();\n\t\t}\n\t\tinstalledChunks[chunkId] = 0;\n\t}\n\treturn __webpack_require__.O(result);\n}\n\nvar chunkLoadingGlobal = self[\"webpackChunkdecidim_development_app\"] = self[\"webpackChunkdecidim_development_app\"] || [];\nchunkLoadingGlobal.forEach(webpackJsonpCallback.bind(null, 0));\nchunkLoadingGlobal.push = webpackJsonpCallback.bind(null, chunkLoadingGlobal.push.bind(chunkLoadingGlobal));","// startup\n// Load entry module and return exports\n// This entry module depends on other loaded chunks and execution need to be delayed\nvar __webpack_exports__ = __webpack_require__.O(undefined, [9098,8276,4486,2337], function() { return __webpack_require__(55865); })\n__webpack_exports__ = __webpack_require__.O(__webpack_exports__);\n"],"names":["deferred","KeyCeremonyComponent","setupElection","bulletinBoardClientParams","electionUniqueId","authorizationExpirationTimestamp","this","setupElectionWithTypesFilter","typesFilter","async","onEvent","onBindRestoreButton","onBindStartButton","onRestore","onComplete","onStart","onTrusteeNeedsToBeRestored","onBackupNeeded","onBindBackupButton","onBackupStarted","onSetupDone","trustee","setup","events","subscribe","event","preventDefault","needsToBeRestored","keyCeremonySetup","setupKeyCeremony","value","backupData","next","uniqueId","election","runKeyCeremony","file","target","files","reader","FileReader","onload","content","result","restore","readAsText","i","$","$keyCeremony","$startButton","find","$backupModal","$backupButton","$backButton","$restoreModal","$restoreButton","getStepRow","step","replace","apiEndpointUrl","data","authorityPublicKeyJSON","JSON","stringify","schemeName","trusteeContext","publicKeyJSON","currentStep","trusteeIdentificationKeys","IdentificationKeys","trusteeWrapperAdapter","DummyTrusteeWrapperAdapter","trusteeId","Error","ElectionGuardTrusteeWrapperAdapter","workerUrl","component","trusteeUniqueId","present","exists","Math","ceil","Number","Date","TRUSTEE_AUTHORIZATION_EXPIRATION_TIME_IN_HOURS","bindEvents","onEventTriggered","on","backupFilename","attr","messageIdentifier","MessageIdentifier","message","messageId","type","MESSAGE_RECEIVED","typeSubtype","$currentStep","foundation","addClass","removeClass","ajax","method","url","contentType","status","headers","prop","window","addEventListener","console","log","html","reason","toString","indexOf","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","undefined","exports","module","id","loaded","__webpack_modules__","call","m","O","chunkIds","fn","priority","notFulfilled","Infinity","length","fulfilled","j","Object","keys","every","key","splice","r","n","getter","__esModule","d","a","definition","o","defineProperty","enumerable","get","g","globalThis","Function","e","obj","prototype","hasOwnProperty","nmd","paths","children","installedChunks","chunkId","webpackJsonpCallback","parentChunkLoadingFunction","moreModules","runtime","some","chunkLoadingGlobal","self","forEach","bind","push","__webpack_exports__"],"sourceRoot":""}