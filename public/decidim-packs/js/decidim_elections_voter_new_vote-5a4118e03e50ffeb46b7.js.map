{"version":3,"file":"js/decidim_elections_voter_new_vote-5a4118e03e50ffeb46b7.js","mappings":"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","sources":["webpack://decidim-development-app/../decidim-elections/app/packs/src/decidim/elections/voter/vote_questions.component.js","webpack://decidim-development-app/../decidim-elections/app/packs/src/decidim/elections/voter/new-vote.js"],"sourcesContent":["/**\n * Vote Questions component.\n */\n\nexport default class VoteQuestionsComponent {\n  constructor($voteWrapper) {\n    this.$voteWrapper = $voteWrapper;\n    this.$continueButton = this.$voteWrapper.find(\"a.focus__next\");\n    this.$confirmButton = this.$voteWrapper.find(\"a.focus__next.confirm\");\n    this.$continueSpan = this.$voteWrapper.find(\"span.disabled-continue\");\n    this.$currentStep = \"\";\n    this.$currentStepMaxSelection = \"\";\n    this.$answerCounter = 0;\n    this.voteCasted = false;\n    window.onbeforeunload = () => {\n      if (this.voteCasted) {\n        return null;\n      }\n      return \"\";\n    }\n  }\n\n  init() {\n    this.setCurrentStep();\n    this.toggleContinueButton();\n    this.$confirmButton.addClass(\"show\").removeClass(\"hide\");\n    $(\".evote__counter-min\").text(this.$answerCounter);\n    this.answerCounter();\n    this.disableCheckbox();\n  }\n\n  setCurrentStep() {\n    this.$currentStep = this.$voteWrapper.find(\".focus__step:visible\")\n    this.setSelections();\n    this.onSelectionChange();\n  }\n\n  toggleContinueButton() {\n    if (this.checkAnswers()) {\n      // next step enabled\n      this.$continueButton.addClass(\"show\").removeClass(\"hide\")\n      this.$continueSpan.addClass(\"hide\").removeClass(\"show\")\n    } else {\n      // next step disabled\n      this.$continueButton.addClass(\"hide\").removeClass(\"show\")\n      this.$continueSpan.addClass(\"show\").removeClass(\"hide\")\n    }\n  }\n\n  // check if answers are correctly checked\n  checkAnswers() {\n    const currentAnswersChecked = $(`#${this.$currentStep.attr(\"id\")} .answer_input:checked`).length\n    const notaAnswerChecked = $(`#${this.$currentStep.attr(\"id\")} .nota_input:checked`).length\n\n    return ((currentAnswersChecked >= 1 || notaAnswerChecked > 0) && (currentAnswersChecked <= this.$currentStepMaxSelection));\n  }\n\n  answerCounter() {\n    let checked = $(`#${this.$currentStep.attr(\"id\")} .answer_input:checked`).length\n    $(\".evote__counter-min\").text(checked);\n  }\n\n  // disable checkboxes if NOTA option is selected\n  disableCheckbox() {\n    $(\"[data-disabled-by]\").on(\"click\", (event) => {\n      if ($(event.target).attr(\"aria-disabled\") || $(event.target).hasClass(\"is-disabled\")) {\n        event.preventDefault();\n      }\n    });\n\n    $(\"[data-disable-check]\").on(\"change\", (event) => {\n      let checkId = $(event.target).attr(\"id\");\n      let checkStatus = event.target.checked;\n\n      this.$currentStep.find(`[data-disabled-by='#${checkId}']`).each((_index, element) => {\n        if (checkStatus) {\n          $(element).addClass(\"is-disabled\");\n          $(element).find(\"input[type=checkbox]\").prop(\"checked\", false);\n          $(element).find(\"input[type=checkbox]\").attr(\"aria-disabled\", \"\");\n        } else {\n          $(element).removeClass(\"is-disabled\");\n          $(element).find(\"input[type=checkbox]\").removeAttr(\"aria-disabled\");\n        }\n      });\n    });\n  }\n\n  setSelections() {\n    this.$currentStepMaxSelection = this.$currentStep.find(\".evote__options\").data(\"max-selection\")\n  }\n\n\n  onSelectionChange() {\n    let $voteOptions = this.$currentStep.find(\".evote__options\");\n    $voteOptions.on(\"change\", () => {\n      this.toggleContinueButton();\n      this.toggleConfirmAnswers();\n      this.answerCounter();\n    });\n  }\n\n  // receive confirmed answers\n  toggleConfirmAnswers() {\n    $(\".answer_input:checked\").each((_index, element) => {\n      const confirmedAnswer = $(\".evote__confirm\").find(`#${element.value}`);\n      $(confirmedAnswer).removeClass(\"hide\")\n    })\n\n    $(\".answer_input\").not(\":checked\").each((_index, element) => {\n      const confirmedAnswer = $(\".evote__confirm\").find(`#${element.value}`);\n      $(confirmedAnswer).addClass(\"hide\")\n    })\n\n    $(\".nota_input:checked\").each((_index, element) => {\n      const confirmedAnswer = $(\".evote__confirm\").find(`.${element.value}`);\n      $(confirmedAnswer).removeClass(\"hide\")\n    })\n\n    $(\".nota_input\").not(\":checked\").each((_index, element) => {\n      const confirmedAnswer = $(\".evote__confirm\").find(`.${element.value}`);\n      $(confirmedAnswer).addClass(\"hide\")\n    })\n  }\n}\n","/* eslint-disable no-console */\nimport VoteQuestionsComponent from \"src/decidim/elections/voter/vote_questions.component\";\n// The voting component might come from set-preview.js or setup-vote.js, it depends if it's a preview\n// so in the view template we load the component and attach it to window\nconst { setupVoteComponent } = window.Decidim;\n\n$(async () => {\n  // UI Elements\n  const $voteWrapper = $(\".vote-wrapper\");\n  const $ballotHash = $voteWrapper.find(\".ballot-hash\");\n  const ballotStyleId = $voteWrapper.data(\"ballotStyleId\");\n\n  // Use the questions component\n  const questionsComponent = new VoteQuestionsComponent($voteWrapper);\n  questionsComponent.init();\n  $(document).on(\"on.zf.toggler\", () => {\n    // continue and back btn\n    questionsComponent.init();\n  });\n\n  // Get the vote component and bind it to all UI events\n  const voteComponent = setupVoteComponent($voteWrapper);\n  await voteComponent.bindEvents({\n    onBindEncryptButton(onEventTriggered) {\n      $(\".button.confirm\").on(\"click\", onEventTriggered);\n    },\n    onStart() {},\n    onVoteEncryption(validVoteFn) {\n      const getFormData = (formData) => {\n        return formData.serializeArray().reduce((acc, { name, value }) => {\n          if (!acc[name]) {\n            acc[name] = [];\n          }\n          acc[name] = [...acc[name], `${name}_${value}`];\n          return acc;\n        }, {});\n      };\n      const formData = getFormData($voteWrapper.find(\".answer_input\"));\n      validVoteFn(formData, ballotStyleId);\n    },\n    castOrAuditBallot({ encryptedData, encryptedDataHash }) {\n      $voteWrapper.find(\"#encrypting\").addClass(\"hide\");\n      $ballotHash.text(encryptedDataHash);\n      $voteWrapper.find(\"#ballot_decision\").removeClass(\"hide\");\n\n      const $form = $(\"form.new_vote\");\n      $(\"#vote_encrypted_data\", $form).val(encryptedData);\n      $(\"#vote_encrypted_data_hash\", $form).val(encryptedDataHash);\n    },\n    onBindAuditBallotButton(onEventTriggered) {\n      $(\".audit_ballot\").on(\"click\", onEventTriggered);\n    },\n    onBindCastBallotButton(onEventTriggered) {\n      $(\".cast_ballot\").on(\"click\", onEventTriggered);\n    },\n    onAuditBallot(auditedData, auditedDataFileName) {\n      const vote = JSON.stringify(auditedData);\n      const link = document.createElement(\"a\");\n      $voteWrapper.find(\".button.cast_ballot\").addClass(\"hide\");\n      $voteWrapper.find(\".button.back\").removeClass(\"hide\");\n      questionsComponent.voteCasted = true;\n\n      link.setAttribute(\"href\", `data:text/plain;charset=utf-8,${vote}`);\n      link.setAttribute(\"download\", auditedDataFileName);\n      document.body.appendChild(link);\n      link.click();\n      document.body.removeChild(link);\n    },\n    onAuditComplete() {\n      console.log(\"Audit completed\");\n    },\n    onCastBallot() {\n      questionsComponent.voteCasted = true;\n      $(\".cast_ballot\").prop(\"disabled\", true);\n    },\n    onCastComplete() {\n      console.log(\"Cast completed\");\n    },\n    onInvalid() {\n      console.log(\"Something went wrong.\");\n    }\n  });\n});\n"],"names":["VoteQuestionsComponent","$voteWrapper","this","$continueButton","find","$confirmButton","$continueSpan","$currentStep","$currentStepMaxSelection","$answerCounter","voteCasted","window","onbeforeunload","_this","_createClass","setCurrentStep","toggleContinueButton","addClass","removeClass","$","text","answerCounter","disableCheckbox","setSelections","onSelectionChange","checkAnswers","currentAnswersChecked","attr","length","notaAnswerChecked","checked","on","event","target","hasClass","preventDefault","checkId","checkStatus","_this2","each","_index","element","prop","removeAttr","data","_this3","toggleConfirmAnswers","confirmedAnswer","value","not","i","setupVoteComponent","Decidim","$ballotHash","ballotStyleId","questionsComponent","init","document","voteComponent","bindEvents","onBindEncryptButton","onEventTriggered","onStart","onVoteEncryption","validVoteFn","formData","serializeArray","reduce","acc","name","getFormData","castOrAuditBallot","encryptedData","encryptedDataHash","$form","val","onBindAuditBallotButton","onBindCastBallotButton","onAuditBallot","auditedData","auditedDataFileName","vote","JSON","stringify","link","createElement","setAttribute","body","appendChild","click","removeChild","onAuditComplete","console","log","onCastBallot","onCastComplete","onInvalid"],"sourceRoot":""}