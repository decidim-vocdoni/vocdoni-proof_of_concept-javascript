{"version":3,"file":"js/decidim_vocdoni_voter_setup_preview-5df98bb28944b3ed71bf.js","mappings":";4QACA,ysOACA,IAEMA,EAAoB,WACxB,cAAkD,IAApCC,EAAgB,EAAhBA,iBAAkBC,EAAa,EAAbA,eAJlC,4FAI+C,SAC3CC,KAAKF,iBAAmBA,EACxBE,KAAKD,cAAgBA,CACvB,CAPF,UA+CG,EAxCAE,EAuDA,OA9DH,EAOGA,EAPH,EAOGA,CAAAA,CAAAA,IAAAA,aAAAA,OAAAA,EAAAA,EAAAA,IAAAA,MAED,gHACEC,EAAmB,EAAnBA,oBACAC,EAAO,EAAPA,QACAC,EAAgB,EAAhBA,iBACAC,EAAiB,EAAjBA,kBACAC,EAAuB,EAAvBA,wBACAC,EAAsB,EAAtBA,uBACAC,EAAa,EAAbA,cACAC,EAAY,EAAZA,aACAC,EAAe,EAAfA,gBACAC,EAAc,EAAdA,eACAC,EAAS,EAATA,UAEAV,EAAmB,YAAC,8EAClBC,IACAC,GACE,SAACS,GACCC,EAAKC,YAAYF,GAAWG,MAAK,SAACC,GAChCZ,EAAkBY,GAClBX,GAAwB,WACtBE,EACES,EAAO,GAAD,OACHH,EAAKf,cAAa,qBAAae,EAAKhB,iBAAgB,SAEzDY,GACF,IAEAH,EAAsB,YAAC,8FACfE,EAAaQ,GAAQ,KAAD,EAC1BN,IAAiB,2CAErB,GACF,IACA,WACEC,GACF,IACA,4CACD,2CACJ,sFACD,WAAkBC,GAAS,iFACnB,IAAIK,SAAQ,SAACC,GAAO,OAAKC,WAAWD,EAhDjB,IAgD+C,IAAE,KAAD,2BAElE,CACLE,cAAeR,EACfS,kBAAmBtB,KAAKuB,kBAAkB,IAC1CC,cAAeX,IAChB,gDACF,6EACD,SAAkBY,GAChB,OAAOC,MAAMD,GACXE,KAAK,IACLC,KAAI,kBAAMC,KAAKC,SAASC,SAAS,IAAIC,OAAO,EAAE,IAC9CC,KAAK,GACT,IA9DF,iFA8DG,EA3DuB,GAwE1BC,OAAOC,QAAUD,OAAOC,SAAW,CAAC,EACpCD,OAAOC,QAAQC,mBAXA,SAA4BC,GACzC,IAAMtC,EAAgBsC,EAAaC,KAAK,WAClCxC,EAAmBuC,EAAaC,KAAK,oBAE3C,OAAO,IAAIzC,EAAqB,CAC9BC,iBAAAA,EACAC,cAAAA,GAEJ","sources":["webpack://decidim-development-app/../decidim-module-vocdoni/app/packs/src/decidim/vocdoni/voter/setup-preview.js"],"sourcesContent":["/* eslint-disable require-jsdoc */\n// The wait time used to simulate the encryption of the vote during the preview\nconst FAKE_ENCRYPTION_TIME = 1000;\n\nclass PreviewVoteComponent {\n  constructor({ electionUniqueId, voterUniqueId }) {\n    this.electionUniqueId = electionUniqueId;\n    this.voterUniqueId = voterUniqueId;\n  }\n\n  async bindEvents({\n    onBindEncryptButton,\n    onStart,\n    onVoteEncryption,\n    castOrAuditBallot,\n    onBindAuditBallotButton,\n    onBindCastBallotButton,\n    onAuditBallot,\n    onCastBallot,\n    onAuditComplete,\n    onCastComplete,\n    onInvalid\n  }) {\n    onBindEncryptButton(async () => {\n      onStart();\n      onVoteEncryption(\n        (plainVote) => {\n          this.fakeEncrypt(plainVote).then((ballot) => {\n            castOrAuditBallot(ballot);\n            onBindAuditBallotButton(() => {\n              onAuditBallot(\n                ballot,\n                `${this.voterUniqueId}-election-${this.electionUniqueId}.txt`\n              );\n              onAuditComplete();\n            });\n\n            onBindCastBallotButton(async () => {\n              await onCastBallot(ballot);\n              onCastComplete();\n            });\n          });\n        },\n        () => {\n          onInvalid();\n        }\n      );\n    });\n  }\n  async fakeEncrypt(plainVote) {\n    await new Promise((resolve) => setTimeout(resolve, FAKE_ENCRYPTION_TIME));\n\n    return {\n      encryptedData: plainVote,\n      encryptedDataHash: this.generateHexString(64),\n      auditableData: plainVote\n    };\n  }\n  generateHexString(length) {\n    return Array(length).\n      fill(\"\").\n      map(() => Math.random().toString(16).charAt(2)).\n      join(\"\");\n  }\n}\n\nexport default function setupVoteComponent($voteWrapper) {\n  const voterUniqueId = $voteWrapper.data(\"voterId\");\n  const electionUniqueId = $voteWrapper.data(\"electionUniqueId\");\n\n  return new PreviewVoteComponent({\n    electionUniqueId,\n    voterUniqueId\n  });\n}\n\nwindow.Decidim = window.Decidim || {};\nwindow.Decidim.setupVoteComponent = setupVoteComponent;\n\n"],"names":["PreviewVoteComponent","electionUniqueId","voterUniqueId","this","_createClass","onBindEncryptButton","onStart","onVoteEncryption","castOrAuditBallot","onBindAuditBallotButton","onBindCastBallotButton","onAuditBallot","onCastBallot","onAuditComplete","onCastComplete","onInvalid","plainVote","_this","fakeEncrypt","then","ballot","Promise","resolve","setTimeout","encryptedData","encryptedDataHash","generateHexString","auditableData","length","Array","fill","map","Math","random","toString","charAt","join","window","Decidim","setupVoteComponent","$voteWrapper","data"],"sourceRoot":""}